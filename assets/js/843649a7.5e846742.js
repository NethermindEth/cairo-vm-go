"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[227],{3905:(t,e,a)=>{a.d(e,{Zo:()=>u,kt:()=>h});var n=a(7294);function i(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function r(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function o(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?r(Object(a),!0).forEach((function(e){i(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function l(t,e){if(null==t)return{};var a,n,i=function(t,e){if(null==t)return{};var a,n,i={},r=Object.keys(t);for(n=0;n<r.length;n++)a=r[n],e.indexOf(a)>=0||(i[a]=t[a]);return i}(t,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(n=0;n<r.length;n++)a=r[n],e.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(t,a)&&(i[a]=t[a])}return i}var s=n.createContext({}),p=function(t){var e=n.useContext(s),a=e;return t&&(a="function"==typeof t?t(e):o(o({},e),t)),a},u=function(t){var e=p(t.components);return n.createElement(s.Provider,{value:e},t.children)},c="mdxType",d={inlineCode:"code",wrapper:function(t){var e=t.children;return n.createElement(n.Fragment,{},e)}},m=n.forwardRef((function(t,e){var a=t.components,i=t.mdxType,r=t.originalType,s=t.parentName,u=l(t,["components","mdxType","originalType","parentName"]),c=p(a),m=i,h=c["".concat(s,".").concat(m)]||c[m]||d[m]||r;return a?n.createElement(h,o(o({ref:e},u),{},{components:a})):n.createElement(h,o({ref:e},u))}));function h(t,e){var a=arguments,i=e&&e.mdxType;if("string"==typeof t||i){var r=a.length,o=new Array(r);o[0]=m;var l={};for(var s in e)hasOwnProperty.call(e,s)&&(l[s]=e[s]);l.originalType=t,l[c]="string"==typeof t?t:i,o[1]=l;for(var p=2;p<r;p++)o[p]=a[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},4331:(t,e,a)=>{a.r(e),a.d(e,{assets:()=>s,contentTitle:()=>o,default:()=>d,frontMatter:()=>r,metadata:()=>l,toc:()=>p});var n=a(7462),i=(a(7294),a(3905));const r={sidebar_position:3},o="Cairo Zero Hints",l={unversionedId:"vm-fundamentals/hints",id:"vm-fundamentals/hints",title:"Cairo Zero Hints",description:"Cairo Zero relies on hints to optimize various operations. To ensure compatibility across different Cairo Virtual Machine, Starkware maintains a list of whitelisted hints that any Cairo VM needs to implement. These hints are essential for the proper functioning of Cairo Zero programs.",source:"@site/docs/vm-fundamentals/hints.md",sourceDirName:"vm-fundamentals",slug:"/vm-fundamentals/hints",permalink:"/docs/vm-fundamentals/hints",draft:!1,editUrl:"https://github.com/NethermindEth/cairo-vm-go/tree/main/docs/docs/vm-fundamentals/hints.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Builtins Documentation",permalink:"/docs/vm-fundamentals/builtins"},next:{title:"VM - Extras",permalink:"/docs/category/vm---extras"}},s={},p=[{value:"Dictionaries",id:"dictionaries",level:2},{value:"ZeroDictionaryManager",id:"zerodictionarymanager",level:3},{value:"ZeroDictionary",id:"zerodictionary",level:3},{value:"Dict functions",id:"dict-functions",level:3},{value:"Hint usage in dict functions",id:"hint-usage-in-dict-functions",level:3},{value:"Usort",id:"usort",level:2},{value:"Hint usage in <code>usort</code> functions",id:"hint-usage-in-usort-functions",level:3},{value:"Blake2s Hash Function",id:"blake2s-hash-function",level:2},{value:"Keccak Hash Function",id:"keccak-hash-function",level:2},{value:"Sha256 Hash Function",id:"sha256-hash-function",level:2},{value:"Uint256",id:"uint256",level:2},{value:"Math Operations",id:"math-operations",level:2},{value:"Elliptic Curve Operations and Signatures",id:"elliptic-curve-operations-and-signatures",level:2},{value:"Other Hints for Various Operations",id:"other-hints-for-various-operations",level:2}],u={toc:p},c="wrapper";function d(t){let{components:e,...a}=t;return(0,i.kt)(c,(0,n.Z)({},u,a,{components:e,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"cairo-zero-hints"},"Cairo Zero Hints"),(0,i.kt)("p",null,"Cairo Zero relies on hints to optimize various operations. To ensure compatibility across different Cairo Virtual Machine, Starkware maintains a list of ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/starkware-libs/cairo-lang/tree/0e4dab8a6065d80d1c726394f5d9d23cb451706a/src/starkware/starknet/security/whitelists"},"whitelisted hints")," that any Cairo VM needs to implement. These hints are essential for the proper functioning of Cairo Zero programs."),(0,i.kt)("p",null,"In this section, we will explore the critical role of hints in Cairo Zero, focusing on two main aspects:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"High-level operations: description of the various computations that necessitate the use of Cairo Zero hints"),(0,i.kt)("li",{parentName:"ul"},"Detailed hint analysis: in-depth look at all hints, explaining their purpose")),(0,i.kt)("h2",{id:"dictionaries"},"Dictionaries"),(0,i.kt)("p",null,"In the Cairo VM, dictionaries are represented by memory segments managed by the ",(0,i.kt)("strong",{parentName:"p"},"ZeroDictionaryManager")," within a scope handled by the ",(0,i.kt)("strong",{parentName:"p"},"ScopeManager"),"."),(0,i.kt)("h3",{id:"zerodictionarymanager"},"ZeroDictionaryManager"),(0,i.kt)("p",null,"A ",(0,i.kt)("strong",{parentName:"p"},"ZeroDictionaryManager")," maps a segment index to a ",(0,i.kt)("strong",{parentName:"p"},"ZeroDictionary"),". Different dictionary managers can exist in various scopes."),(0,i.kt)("h3",{id:"zerodictionary"},"ZeroDictionary"),(0,i.kt)("p",null,"A ",(0,i.kt)("strong",{parentName:"p"},"ZeroDictionary")," consists of three fields:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("strong",{parentName:"li"},"Data"),": A map storing the (key, value) pairs of the dictionary."),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("strong",{parentName:"li"},"DefaultValue"),": An optional field holding the default value for a key if it doesn't exist in the Data field."),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("strong",{parentName:"li"},"FreeOffset"),": Tracks the next free offset in the dictionary segment.")),(0,i.kt)("p",null,"A dictionary segment writes data in sets of three values:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("strong",{parentName:"li"},"Key")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("strong",{parentName:"li"},"Previous Value")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("strong",{parentName:"li"},"New Value"))),(0,i.kt)("p",null,"For example, if key ",(0,i.kt)("inlineCode",{parentName:"p"},"k1")," has a value ",(0,i.kt)("inlineCode",{parentName:"p"},"v1")," and is updated to value ",(0,i.kt)("inlineCode",{parentName:"p"},"v2"),", the dictionary segment will write three values: ",(0,i.kt)("inlineCode",{parentName:"p"},"k1"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"v1"),", and ",(0,i.kt)("inlineCode",{parentName:"p"},"v2")," in consecutive offsets. Any dictionary access operation, such as reading or writing, will similarly add data to the segment. For instance, a read operation on key ",(0,i.kt)("inlineCode",{parentName:"p"},"k1")," with value ",(0,i.kt)("inlineCode",{parentName:"p"},"v1")," will write ",(0,i.kt)("inlineCode",{parentName:"p"},"k1"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"v1"),", and ",(0,i.kt)("inlineCode",{parentName:"p"},"v1")," to consecutive offsets."),(0,i.kt)("p",null,"Dictionary operations in Cairo are covered in two library files:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/starkware-libs/cairo-lang/blob/master/src/starkware/cairo/common/dict.cairo"},"dict.cairo")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/starkware-libs/cairo-lang/blob/master/src/starkware/cairo/common/default_dict.cairo"},"default_dict.cairo"))),(0,i.kt)("p",null,"These functions require specific hints to be implemented in the VM."),(0,i.kt)("h3",{id:"dict-functions"},"Dict functions"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"dict_new"),(0,i.kt)("li",{parentName:"ol"},"default_dict_new"),(0,i.kt)("li",{parentName:"ol"},"dict_read"),(0,i.kt)("li",{parentName:"ol"},"dict_write"),(0,i.kt)("li",{parentName:"ol"},"dict_update"),(0,i.kt)("li",{parentName:"ol"},"dict_squash")),(0,i.kt)("h3",{id:"hint-usage-in-dict-functions"},"Hint usage in dict functions"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Hint"),(0,i.kt)("th",{parentName:"tr",align:null},"Usage"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"DictNew"),(0,i.kt)("td",{parentName:"tr",align:null},"dict_new, dict_squash")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"DefaultDictNew"),(0,i.kt)("td",{parentName:"tr",align:null},"default_dict_new")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"DictRead"),(0,i.kt)("td",{parentName:"tr",align:null},"dict_read")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"DictWrite"),(0,i.kt)("td",{parentName:"tr",align:null},"dict_write")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"DictUpdate"),(0,i.kt)("td",{parentName:"tr",align:null},"dict_update")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"DictSquashCopyDict"),(0,i.kt)("td",{parentName:"tr",align:null},"dict_squash")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"VMExitScope"),(0,i.kt)("td",{parentName:"tr",align:null},"dict_squash")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"SquashDict"),(0,i.kt)("td",{parentName:"tr",align:null},"dict_squash")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"SquashDictInnerFirstIteration"),(0,i.kt)("td",{parentName:"tr",align:null},"dict_squash")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"SquashDictInnerSkipLoop"),(0,i.kt)("td",{parentName:"tr",align:null},"dict_squash")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"SquashDictInnerCheckAccessIndex"),(0,i.kt)("td",{parentName:"tr",align:null},"dict_squash")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"SquashDictInnerContinueLoop"),(0,i.kt)("td",{parentName:"tr",align:null},"dict_squash")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"SquashDictInnerLenAssert"),(0,i.kt)("td",{parentName:"tr",align:null},"dict_squash")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"SquashDictInnerUsedAccessesAssert"),(0,i.kt)("td",{parentName:"tr",align:null},"dict_squash")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"SquashDictInnerAssertLenKeys"),(0,i.kt)("td",{parentName:"tr",align:null},"dict_squash")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"SquashDictInnerNextKey"),(0,i.kt)("td",{parentName:"tr",align:null},"dict_squash")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"DictSquashUpdatePtr"),(0,i.kt)("td",{parentName:"tr",align:null},"dict_squash")))),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"dict_new")),(0,i.kt)("p",null,"Creates a new dictionary. It requires an ",(0,i.kt)("strong",{parentName:"p"},"initial_dict")," variable set in the scope. The ",(0,i.kt)("strong",{parentName:"p"},"DictNew")," hint creates a new ",(0,i.kt)("strong",{parentName:"p"},"DictionaryManager")," in the scope if not present and uses the ",(0,i.kt)("strong",{parentName:"p"},"initial_dict")," variable to seed and create a new dictionary."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"default_dict_new")),(0,i.kt)("p",null,"Creates a new dictionary with a default value. It expects a ",(0,i.kt)("strong",{parentName:"p"},"default_value")," Cairo variable. The ",(0,i.kt)("strong",{parentName:"p"},"DefaultDictNew")," hint creates a new ",(0,i.kt)("strong",{parentName:"p"},"DictionaryManager")," in the scope if not present and creates a new dictionary where the default value for a key not present in the Data field is the ",(0,i.kt)("strong",{parentName:"p"},"default_value")," variable."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"dict_read")),(0,i.kt)("p",null,"Reads a value from the dictionary and returns it. Reading a key involves writing three values to the dictionary segment: key, previous value, and new value. The ",(0,i.kt)("strong",{parentName:"p"},"DictRead")," hint increments the current_ptr of the dictionary in the ",(0,i.kt)("strong",{parentName:"p"},"DictionaryManager")," by three and writes the read value to a Cairo variable ",(0,i.kt)("strong",{parentName:"p"},"value"),"."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"dict_write")),(0,i.kt)("p",null,"Writes a value to the dictionary, overriding the existing value. Writing a key involves writing three values to the dictionary segment: key, previous value, and new value. The ",(0,i.kt)("strong",{parentName:"p"},"DictWrite")," hint increments the current_ptr of the dictionary in the ",(0,i.kt)("strong",{parentName:"p"},"DictionaryManager")," by three, updates the actual value of the key in the ",(0,i.kt)("strong",{parentName:"p"},"Dictionary"),", and writes the ",(0,i.kt)("strong",{parentName:"p"},"prev_value")," to the dictionary segment."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"dict_update")),(0,i.kt)("p",null,"Updates a value in the dictionary. Updating a key involves writing three values to the dictionary segment: key, previous value, and new value. The ",(0,i.kt)("strong",{parentName:"p"},"DictUpdate")," hint increments the current_ptr of the dictionary in the ",(0,i.kt)("strong",{parentName:"p"},"DictionaryManager")," by three, updates the actual value of the key in the ",(0,i.kt)("strong",{parentName:"p"},"Dictionary"),", and asserts that the given Cairo variable prev_value matches the key's value before updating."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"dict_squash")),(0,i.kt)("p",null,"Returns a new dictionary with one DictAccess instance per key (value before and value after) summarizing all the changes to that key. The dict_squash function involves 13 hints, as shown in the table above."),(0,i.kt)("p",null,"Example:"),(0,i.kt)("p",null,"Input: {(key1, 0, 2), (key1, 2, 7), (key2, 4, 1), (key1, 7, 5), (key2, 1, 2)}"),(0,i.kt)("p",null,"Output: {(key1, 0, 5), (key2, 4, 2)} "),(0,i.kt)("h2",{id:"usort"},"Usort"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"usort")," Cairo ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/starkware-libs/cairo-lang/blob/0e4dab8a6065d80d1c726394f5d9d23cb451706a/src/starkware/cairo/common/usort.cairo#L8"},"function")," is used to sort an array of field elements while removing duplicates. It returns the sorted array in ascending order and its length along with the multiplicities of each unique element."),(0,i.kt)("h3",{id:"hint-usage-in-usort-functions"},"Hint usage in ",(0,i.kt)("inlineCode",{parentName:"h3"},"usort")," functions"),(0,i.kt)("p",null,"Overall, ",(0,i.kt)("inlineCode",{parentName:"p"},"usort")," Cairo function requires 5 hints to be executed:"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"UsortEnterScope")),(0,i.kt)("p",null,"Enters a new scope with ",(0,i.kt)("inlineCode",{parentName:"p"},"__usort_max_size")," set to either:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"0")," if ",(0,i.kt)("inlineCode",{parentName:"li"},"__usort_max_size")," variable is not found in ",(0,i.kt)("inlineCode",{parentName:"li"},"globals()")," scope"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"1 << 20")," if ",(0,i.kt)("inlineCode",{parentName:"li"},"__usort_max_size")," variable is found ",(0,i.kt)("inlineCode",{parentName:"li"},"globals()")," scope")),(0,i.kt)("p",null,"This hint is used to potentially set a maximum length to the array to be sorted."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"UsortBody")),(0,i.kt)("p",null,"Core hint that does most of the sorting operation computation. It uses a dictionnary to group input elements and their positions. Then, it sorts the unique elements and generates the output array and multiplicities, with multiplicities being the number of times a given value appeared in the input."),(0,i.kt)("p",null,"After execution this hint, the Cairo code will call ",(0,i.kt)("inlineCode",{parentName:"p"},"verify_usort")," recursive function, which ensures correctness of the sorting and multiplicity counting."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"UsortVerify")),(0,i.kt)("p",null,"Prepares for the verification of the multiplicity of the current value in the sorted output."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"UsortVerifyMultiplicityAssert")),(0,i.kt)("p",null,"Checks that the array of positions in scope doesn't contain any value. This hint actually implements the base case for the ",(0,i.kt)("inlineCode",{parentName:"p"},"verify_multiplicity")," Cairo recursive function."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"UsortVerifyMultiplicityBody")," "),(0,i.kt)("p",null,"Extracts a specific value of the sorted array with ",(0,i.kt)("inlineCode",{parentName:"p"},"pop"),", updating indices for the verification of the next value in the recursive call."),(0,i.kt)("h2",{id:"blake2s-hash-function"},"Blake2s Hash Function"),(0,i.kt)("h2",{id:"keccak-hash-function"},"Keccak Hash Function"),(0,i.kt)("h2",{id:"sha256-hash-function"},"Sha256 Hash Function"),(0,i.kt)("h2",{id:"uint256"},"Uint256"),(0,i.kt)("h2",{id:"math-operations"},"Math Operations"),(0,i.kt)("h2",{id:"elliptic-curve-operations-and-signatures"},"Elliptic Curve Operations and Signatures"),(0,i.kt)("h2",{id:"other-hints-for-various-operations"},"Other Hints for Various Operations"),(0,i.kt)("h1",{id:"cairo-one-hints"},"Cairo One Hints"))}d.isMDXComponent=!0}}]);